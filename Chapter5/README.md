# 제5고지

## 52단계. GPU 지원
- cupy: GPU를 사용해 병렬 계산을 해주는 라이브러리
- `pip install cupy` 
- `cp.get_array_module` : 주어진 데이터에 적합한 모듈을 돌려줌
- Variable class
    - 데이터가 cupy.ndarray 가 넘어와도 대응할 수 있도록 수정
    - 기울기를 자동으로 보완하는 부분 수정
    - 데이터를 gpu 혹은 cpu로 전송해주는 기능 추가

## 53단계. 모델 저장 및 읽어오기
- 모델의 매개변수를 외부 파일로 저장 및 읽어오기
- Dezero의 매개변수: Parameter class로 구현
- `np.save` & `np.load`
- 여러 개의 ndarray 인스턴스를 저장하고 읽어올 수 있음
- Layer 클래스 매개변수를 평평하게: `_flatte_` 메서드 사용

## 54단계. 드롭아웃과 테스트 모드
- 과적합을 해결하는 방법 : 가중치 감소 / 드롭아웃 / 배치 정규화
- 드롭아웃
    - 뉴런을 임의로 비활성화하면서 학습
- 역 드롭아웃
    - 스케일 맞추기를 학습할 때 수행
    - 장점: 테스트 시 아무런 처리도 하지 않기 때문에 테스트 속도가 향상
    - dropout ratio를 동적으로 변경할 수 있음

## 55단계. CNN 메커니즘 (1)
- Convolutional Neural Network의 약자
- CNN 신경망의 구조
    - 합성곱층 (Conv), 풀링층(Pool) 으로 구성
    - Conv -> ReLU -> (Pool) 순서로 연결
- 연산
    - 이미지 처리에서 말하는 필터 연산
    - 입력 데이터에 필터를 적용 (filter = kernel)
    - 필터 윈도를 일정 간격으로 이동시키면서 적용
- 패딩 Padding
    - 합성곱층의 주요 처리 전 입력데이터 주위에 고정값을 채울 수 있음
    - 출력 크기를 조정하기 위해 사용 (필터로 인해 출령 형상이 줄어듬)
- 스트라이드 Stride
    - 필터를 적용하는 위치의 간격
- 출력 크기 계산 방법: step55.py

## 56단계. CNN 메커니즘(2)
- step55에서는 수직 및 수평 방향으로 늘어선 2차원 텐서 기준
- RGB 이미지는 채널 방향으로도 데이터가 쌓여있기 때문에 3차원 텐서를 다뤄야 함
- 2차원과 연산 절차는 똑같으나, 입력 데이터와 필터의 채널 수를 맞춰줘야함
- (channel, height, width) 순으로 정렬된 직육면체로 생각하자
- 출력: Feature map (특징 맵)
- feature map을 채널 방향으로 여러장 갖고 싶다면 다수의 필터를 사용하면 됨
- 편향은 채널 당 하나의 값만 가짐 `(OC, 1, 1)`
- 미니배치 처리: `(N, C, H, W)` -> 배치를 위한 차원 추가
- 풀링층: 가로, 세로 공간을 작게 만드는 연산
    - Max pooling: 필터 크기 안의 영역에서 최댓값을 취하는 연산
    - 특징 1. 학습하는 매개변수가 없다
    - 특징 2. 채널 수가 변하지 않는다
    - 특징 3. 미세한 위치 변화에 영향을 덜 받는다 (robust)

## 57단계. conv2d 함수와 pooling 함수
- for 문을 사용하면 귀찮고 속도가 느려짐
- im2col 함수를 사용해 구현 (image to column)
    - 입력 데이터를 한줄로 전개하는 함수
    - 3차원 텐서로부터 커널을 적용할 영역을 추출
    - 원소 수가 원래보다 많아져 메모리를 많이 소비하지만 행렬 곱으로 계산할 수 있기 때문에 라이브러리가 제공하는 최적화된 함수 혜택을 활용 가능
- conv2d 함수 구현
    - Variable 인스턴스를 받아 backward 호출, 미분 계산 가능

## 58단계. 대표적인 CNN (VGG16)
- VGG 16 특징
    - 3 by 3 합성곱층 사용, 1 by 1 패딩
    - 합성곱층 채널 수는 풀링하면 2배로 층가
    - FCN 에서는 드롭아웃 사용
    - 활성화 함수: ReLU
- 구성
    - 초기화: 필요한 계층 생성 
    - `forward`: 계층들과 함수를 사용해 진행
    - 입력 데이터의 채널수 지정 없이 순전파 시 흐르는 데이터에서 얻음


## 59단계. RNN을 활용한 시계열 데이터 처리
- feed forward: 데이터를 순방향으로만 입력
- $ h_t = tanh(h_{t-1}W(h) + x_t W_x +b)
- 시계열 데이터이므로 입력 데이터의 정답은 같은 데이터 내에 존재 

## 60단계. LSTM과 데이터 로더
- 시계열 데이터용 데이터 로더 만들기
- RNN 계층 대신 LSTM 계층 사용